{"ast":null,"code":"import { verify } from \"jsonwebtoken\";\nimport sqlite from \"sqlite\";\nimport { secret } from \"../../../api/secret\";\n\nconst authenticated = fn => async (req, res) => {\n  verify(req.headers.authorization, secret, async (err, decoded) => {\n    if (!err && decoded) {\n      await fn(req, res);\n    }\n\n    res.status(500).json({\n      message: \"Sorry, you are not authorized!\"\n    });\n  });\n};\n\nexport default authenticated(async function getPeople(req, res) {\n  const db = await sqlite.open(\"./mydb.sqlite\");\n  const people = await db.all(\"select id, email, name from person\");\n  res.json(people);\n});","map":{"version":3,"sources":["/Users/daniel/Documents/development/NEXTJS/nextjs-auth/src/pages/api/people.ts"],"names":["verify","sqlite","secret","authenticated","fn","req","res","headers","authorization","err","decoded","status","json","message","getPeople","db","open","people","all"],"mappings":"AAAA,SAASA,MAAT,QAAuB,cAAvB;AAEA,OAAOC,MAAP,MAAmB,QAAnB;AACA,SAASC,MAAT,QAAuB,qBAAvB;;AAEA,MAAMC,aAAa,GAAIC,EAAD,IAAwB,OAC5CC,GAD4C,EAE5CC,GAF4C,KAGzC;AACHN,EAAAA,MAAM,CAACK,GAAG,CAACE,OAAJ,CAAYC,aAAb,EAA6BN,MAA7B,EAAqC,OAAOO,GAAP,EAAYC,OAAZ,KAAwB;AACjE,QAAI,CAACD,GAAD,IAAQC,OAAZ,EAAqB;AACnB,YAAMN,EAAE,CAACC,GAAD,EAAMC,GAAN,CAAR;AACD;;AACDA,IAAAA,GAAG,CAACK,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,MAAAA,OAAO,EAAE;AAAX,KAArB;AACD,GALK,CAAN;AAMD,CAVD;;AAYA,eAAeV,aAAa,CAAC,eAAeW,SAAf,CAC3BT,GAD2B,EAE3BC,GAF2B,EAG3B;AACA,QAAMS,EAAE,GAAG,MAAMd,MAAM,CAACe,IAAP,CAAY,eAAZ,CAAjB;AACA,QAAMC,MAAM,GAAG,MAAMF,EAAE,CAACG,GAAH,CAAO,oCAAP,CAArB;AAEAZ,EAAAA,GAAG,CAACM,IAAJ,CAASK,MAAT;AACD,CAR2B,CAA5B","sourcesContent":["import { verify } from \"jsonwebtoken\";\nimport { NextApiHandler, NextApiRequest, NextApiResponse } from \"next\";\nimport sqlite from \"sqlite\";\nimport { secret } from \"../../../api/secret\";\n\nconst authenticated = (fn: NextApiHandler) => async (\n  req: NextApiRequest,\n  res: NextApiResponse\n) => {\n  verify(req.headers.authorization!, secret, async (err, decoded) => {\n    if (!err && decoded) {\n      await fn(req, res);\n    }\n    res.status(500).json({ message: \"Sorry, you are not authorized!\" });\n  });\n};\n\nexport default authenticated(async function getPeople(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  const db = await sqlite.open(\"./mydb.sqlite\");\n  const people = await db.all(\"select id, email, name from person\");\n\n  res.json(people);\n});\n"]},"metadata":{},"sourceType":"module"}